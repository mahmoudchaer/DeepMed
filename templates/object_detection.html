{% extends "base.html" %}

{% block title %}DeepMed - Object Detection{% endblock %}

{% block content %}
<div class="card shadow">
    <div class="card-body">
        <h1 class="mb-4">Object Detection - YOLOv5</h1>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h4>Fine-tune YOLOv5 for Object Detection</h4>
                    <p>Upload a ZIP file with your dataset in YOLOv5 format to fine-tune a pre-trained YOLOv5 model.</p>
                    <p>The dataset should include a data.yaml file and image folders with annotations.</p>
                    <p><strong>Note:</strong> Fine-tuning is computationally intensive and may take several minutes.</p>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Upload Dataset & Configure Training</h5>
                    </div>
                    <div class="card-body">
                        <form id="yoloForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="zipFile" class="form-label">Dataset ZIP File</label>
                                <input type="file" class="form-control" id="zipFile" name="zipFile" accept=".zip" required>
                                <div class="form-text">ZIP file containing your YOLOv5 dataset (images, labels, data.yaml)</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="level" class="form-label">Training Level</label>
                                <select class="form-select" id="level" name="level">
                                    <option value="1">Level 1 - Fast (Nano model, 20 epochs, lower resolution)</option>
                                    <option value="2">Level 2 - Standard (Small model, 30 epochs, medium resolution)</option>
                                    <option value="3" selected>Level 3 - Balanced (Small model, 50 epochs, full resolution)</option>
                                    <option value="4">Level 4 - Extended (Medium model, 80 epochs, full resolution)</option>
                                    <option value="5">Level 5 - Advanced (Large model, 100 epochs, full resolution)</option>
                                </select>
                                <div class="form-text">Higher levels produce better models but take longer to train</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="num_classes" class="form-label">Number of Classes</label>
                                <input type="number" class="form-control" id="num_classes" name="num_classes" min="1" placeholder="Leave empty for auto-detection">
                                <div class="form-text">Manually specify the number of classes in your dataset (optional)</div>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary" id="submitBtn">Fine-tune Model</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Training Process</h5>
                    </div>
                    <div class="card-body">
                        <div id="statusBox" class="d-none">
                            <div class="alert alert-info mb-3">
                                <span id="statusMessage">Processing... This may take several minutes.</span>
                            </div>
                            
                            <div id="resultMessage" class="d-none">
                                <div class="alert alert-success">
                                    <p class="mb-1">Training complete! <a id="downloadLink" href="#" class="alert-link">Download YOLOv5 model</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">YOLOv5 Dataset Format</h5>
                    </div>
                    <div class="card-body">
                        <p>Your dataset ZIP should have this exact structure:</p>
                        <pre class="bg-light p-3 small">
your_dataset.zip
└── dataset_folder/  (can be any name)
    ├── train/
    │   ├── images/  (JPG/PNG files)
    │   └── labels/  (TXT files in YOLO format)
    └── valid/
        ├── images/  (JPG/PNG files)
        └── labels/  (TXT files in YOLO format)
</pre>
                        <p><strong>Important:</strong> The folder name "valid" (not "val") must be used for validation data.</p>
                        <p>No data.yaml file is required - it will be generated automatically.</p>
                        
                        <p>Labels should be in YOLO format (one .txt file per image):</p>
                        <pre class="bg-light p-3 small">
&lt;class_id&gt; &lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;
</pre>
                        <p>Example: <code>0 0.5 0.5 0.25 0.25</code> (class 0, center at (0.5, 0.5), width 0.25, height 0.25)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/object_detection.js"></script>
{% endblock %} 